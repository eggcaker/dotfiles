import json
import pendulum
import pandas

def get_date_string(seconds, offset):
    return pendulum.from_timestamp(int(seconds), tz=int(offset) / 60).format('YYYY-MM-DD HH:mm:ss')


removed_daily_fields = [
    'Id',
    'activityType',
    'createdDate',
    'deleted',
    'endTime',
    'floors',
    'met',
    'mood',
    'partnerSyncHash',
    'partnerSyncState',
    'recordedBy',
    'recordedForDatetimeIso8601',
    'recordedTimezoneOffsetInMinutes',
    'recordedUnixtime',
    'startTime',
    'sync_activity_id',
    'sync_activity_state',
    'user_id',
    # minutely
    'endTimeTimezoneOffset',
    'lastSeenStepCounterReading',
    'lastSeenStepCounterTimeStamp',
    'recordType',
    'startTimeTimezoneOffset',
    'recordedForDateTimezoneOffset'
]

with open('./MDData.db.json') as db:
    raw_json = json.load(db)

daily = pandas.DataFrame.from_dict(raw_json['MDData.db']['dailyActivityLog'])
minutely = pandas.DataFrame.from_dict(raw_json['MDData.db']['minutelyActivityLog'])

daily.activeTimeInSeconds = daily.activeTimeInSeconds.astype('int64', copy=False)
daily.distanceInMeters = daily.distanceInMeters.astype('float', copy=False)
daily.steps= daily.steps.astype('int64', copy=False)
daily.recordedForDate.astype('int64', copy=False)

daily.drop(removed_daily_fields, axis=1, inplace=True,  errors='ignore')
daily.sort_index(ascending=False, inplace=True)
minutely.drop(removed_daily_fields, axis=1, inplace=True,  errors='ignore')
minutely.sort_index(ascending=False, inplace=True)

# daily_head = {x:x for x in daily[0].keys()}
# minutely_head = {x:x for x in minutely[0].keys()}

# daily_top_10 = [x for x in reversed(daily)][:10]
# daily_top_50 = [x for x in reversed(daily)][:50]
# daily_top_100 = [x for x in reversed(daily)][:100]

# daily_top_10.insert(0,daily_head)
# daily_top_50.insert(0,daily_head)
# daily_top_100.insert(0,daily_head)

# minutely_top_10 = [x for x in reversed(minutely)][:10]
# minutely_top_50 = [x for x in reversed(minutely)][:50]
# minutely_top_100 = [x for x in reversed(minutely)][:100]

# minutely_top_10.insert(0,minutely_head)
# minutely_top_50.insert(0,minutely_head)
# minutely_top_100.insert(0,minutely_head)
