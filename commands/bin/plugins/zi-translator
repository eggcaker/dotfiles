#!/usr/bin/env node 

/*
#        name: gh-translator
# description: translate the word to different language
#       alias: [translator]; t=translator; ht="help translator"
#      author: eggcaker <eggcaker@gmail.com>
#     updated: 2014-09-03  
*/


var debug = require('debug')('gh-search');
var util = require('util');
var nodegrass = require('nodegrass');
var Table = require('cli-table');
var req = require('request');
var css = require('term-css');
var fs = require('fs');
var query= require("querystring");
var xmllite = require("node-xml-lite");

var style = fs.readFileSync(__dirname + '/config/style.css', 'utf8');

var translator = require('commander');

translator.parse(process.argv); 

var words = translator.args; 

if (words.length) {
    var q = words[0];
    var url = "http://dict-co.iciba.com/api/dictionary.php?w="+query.escape(q) +"&key=703BF409BA9B6A4EBE527A358150D259";
    get_word_data(url);
} else {
   translator.help();
}


function get_word_data(url)
{
    nodegrass.get(url, function(data, status, headers) {
        var obj = xmllite.parseString(data);
        var result = new Object();

        result.key = "单词: ";
        result.items = new Array();

        for (var i=1; i< obj.childs.length; i+=2) {

            var o = obj.childs[i];
            switch(o.name) {
                case "key":
                result.key += o.childs[0];
                break; 
                case "ps":
                result.key += " [ " + o.childs[0] +" ]";
                break;
                case "pos":
                result.items[result.items.length] = o.childs[0] +"\t  " + obj.childs[i+2].childs[0];
                break;
            }
        }

        console.log();
        console.log(result.key);
        console.log("--------------------------------------------------");
        console.log();
        console.log();

        result.items.forEach(function(obj, idx, arr) {
            console.log(obj);
        });
    });
}
